<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>git项目同步上游项目到本项目</title>
      <link href="//git/git-fork-sync.html"/>
      <url>//git/git-fork-sync.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>今天工作是遇到部分功能更新要在上游和本地项目中同步更新，不想两个项目都要同步复制代码，于是想到了git fork的子项目可以拉取上游项目的理，便做一下相关记录</p><hr><h3 id="查看项目绑定的远程仓库地址"><a href="#查看项目绑定的远程仓库地址" class="headerlink" title="查看项目绑定的远程仓库地址"></a>查看项目绑定的远程仓库地址</h3><p>用以下命令查看当前项目绑定的远程仓库</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">originhttps://github.com/gyx/java-dgjy-build-admin.git (fetch)</span><br><span class="line">originhttps://github.com/gyx/java-dgjy-build-admin.git (push)</span><br></pre></td></tr></table></figure><h3 id="添加新的远程仓库地址"><a href="#添加新的远程仓库地址" class="headerlink" title="添加新的远程仓库地址"></a>添加新的远程仓库地址</h3><p>用以下明令添加上游项目的远程仓库的地址：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加新仓库 upstream(上游) 可以自定义</span></span><br><span class="line">git remote add upstream https://github.com/gyx/java-dgjy-build.git</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取远程仓库地址分支信息</span></span><br><span class="line">git fetch upstream</span><br></pre></td></tr></table></figure><p>注：两个仓库有相同的分支名的时候，最好不要直接checkout上游分支，可能和本地分支冲突。</p><p>再用上一步命令查看已绑定的远程仓库的地址输出如下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">originhttps://github.com/gyx/java-dgjy-build-admin.git (fetch)</span><br><span class="line">originhttps://github.com/gyx/java-dgjy-build-admin.git (push)</span><br><span class="line">upstreamhttps://github.com/gyx/java-dgjy-build.git (fetch)</span><br><span class="line">upstreamhttps://github.com/gyx/java-dgjy-build.git (push)</span><br></pre></td></tr></table></figure><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>剩下的操作就都可以直接用idea等git管理软件来完成了。</p>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> fork </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>conda命令</title>
      <link href="//python/conda-command.html"/>
      <url>//python/conda-command.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>记一下conda在Linux系统环境下的安装和应用。</p><hr><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>conda共存在anaconda、miniconda、miniforge、conda等多个不同的工具，这里不过多讨论它们的差别，只讲一下安装miniconda的过程</p><h4 id="下载可执行安装文件"><a href="#下载可执行安装文件" class="headerlink" title="下载可执行安装文件"></a>下载可执行安装文件</h4><p>文件地址：<code>https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh</code></p><p>注：anaconda下载地址为</p><p><code>https://repo.anaconda.com/archive/Anaconda3-5.3.0-Linux-x86_64.sh</code></p><p><img src="https://images.jzwfan.com/image/2025/03/11/143359-0.png" alt=""></p><h4 id="执行安装命令"><a href="#执行安装命令" class="headerlink" title="执行安装命令"></a>执行安装命令</h4><p>根据提示一直输入<code>yes</code>即可</p><p><img src="https://images.jzwfan.com/image/2025/03/11/144437-0.png" alt=""></p><h4 id="验证是否安装完成"><a href="#验证是否安装完成" class="headerlink" title="验证是否安装完成"></a>验证是否安装完成</h4><p>运行<code>conda --version</code>打印出版本号证明已安装成功</p><p><img src="https://images.jzwfan.com/image/2025/03/11/145803-0.png" alt="image-20250311145758305"></p><p>如果提示不存在的命令，在<code>.bashrc</code>文件中加入以下命令再刷新命令即可，具体命令如下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~ # 切换到家目录</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在.bashrc最后一行加入 <span class="built_in">export</span> PATH=<span class="string">&quot;/root/miniconda3/bin:<span class="variable">$PATH</span>&quot;</span> 代码</span></span><br><span class="line">echo &#x27;export PATH=&quot;/root/miniconda3/bin:$PATH&quot;&#x27; &gt; .bashrc </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新环境变量</span></span><br><span class="line">source .bashrc </span><br></pre></td></tr></table></figure><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><h4 id="创建环境"><a href="#创建环境" class="headerlink" title="创建环境"></a>创建环境</h4><p>创建python版本为3.6的环境，取名p36</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda create -n p36 python=3.6</span><br></pre></td></tr></table></figure><h4 id="激活-切换环境"><a href="#激活-切换环境" class="headerlink" title="激活\切换环境"></a>激活\切换环境</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda activate p36</span><br></pre></td></tr></table></figure><h4 id="退出环境"><a href="#退出环境" class="headerlink" title="退出环境"></a>退出环境</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda deactivate</span><br></pre></td></tr></table></figure><h4 id="删除环境"><a href="#删除环境" class="headerlink" title="删除环境"></a>删除环境</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda remove -n p36 --all</span><br></pre></td></tr></table></figure><h4 id="查看已有环境"><a href="#查看已有环境" class="headerlink" title="查看已有环境"></a>查看已有环境</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda info --env</span><br></pre></td></tr></table></figure><h4 id="在环境内安装包"><a href="#在环境内安装包" class="headerlink" title="在环境内安装包"></a>在环境内安装包</h4><p>已pymsql包为例</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conda activate p36 # 切换到指定环境</span><br><span class="line">conda install pymysql # 安装pymsql包</span><br></pre></td></tr></table></figure><p>注：如果conda包安装不成功，可用pip来安装</p><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>anaconda、miniconda、miniforge、conda等多个不同的工具区别参考以下文章：</p><p><a href="https://zhuanlan.zhihu.com/p/518926990">https://zhuanlan.zhihu.com/p/518926990</a></p><p>安装参考以下文章：</p><p><a href="https://blog.csdn.net/wyf2017/article/details/118676765">https://blog.csdn.net/wyf2017/article/details/118676765</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> conda </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>conda占用高CPU问题</title>
      <link href="//python/conda-problem0.html"/>
      <url>//python/conda-problem0.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>前几天在欧拉系统安装了一个miniconda，用来管理python的各版本，本来系统cpu占用为4%左右，安装后cpu占用一直在20%以上。</p><hr><h3 id="定位问题"><a href="#定位问题" class="headerlink" title="定位问题"></a>定位问题</h3><p>用<code>top</code>命令发现有一个名为conda的进程一直居高不下，百度发现是当前用户 <code>～/.bashrc</code>文件（如果用了omz,文件为<code>～/.zshrc</code>）中多了以下一段代码</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">!! Contents within this block are managed by <span class="string">&#x27;conda init&#x27;</span> !!</span></span><br><span class="line">__conda_setup=&quot;$(&#x27;/root/miniconda3/bin/conda&#x27; &#x27;shell.bash&#x27; &#x27;hook&#x27; 2&gt; /dev/null)&quot;</span><br><span class="line">if [ $? -eq 0 ]; then</span><br><span class="line">    eval &quot;$__conda_setup&quot;</span><br><span class="line">else</span><br><span class="line">   if [ -f &quot;/root/miniconda3/etc/profile.d/conda.sh&quot; ]; then</span><br><span class="line">        . &quot;/root/miniconda3/etc/profile.d/conda.sh&quot;</span><br><span class="line">   else</span><br><span class="line">       export PATH=&quot;/root/miniconda3/bin:$PATH&quot; # 这里根据安装的软件不同而有不同变化</span><br><span class="line">   fi</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># unset __conda_setup</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;&lt;&lt; <span class="string">conda initialize &lt;&lt;&lt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="处理方式"><a href="#处理方式" class="headerlink" title="处理方式"></a>处理方式</h3><ul><li>1、注释或删除该代码</li><li>2、在<code>～/.bashrc</code>（<code>~/.zshrc</code>）文件最后添加</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装不同软件文件夹名不同</span></span><br><span class="line">export PATH=&quot;/root/miniconda3/bin:$PATH&quot;</span><br></pre></td></tr></table></figure><hr><p>参考地址：<a href="https://blog.csdn.net/weixin_43495948/article/details/129459638">https://blog.csdn.net/weixin_43495948/article/details/129459638</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> conda </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux挂载网络硬盘</title>
      <link href="//linux/network-hard-disk.html"/>
      <url>//linux/network-hard-disk.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Linux开机自动挂载smb网络硬盘</p><hr><h3 id="安装cifs-utils插件"><a href="#安装cifs-utils插件" class="headerlink" title="安装cifs-utils插件"></a>安装<code>cifs-utils</code>插件</h3><h4 id="Redhat系"><a href="#Redhat系" class="headerlink" title="Redhat系"></a>Redhat系</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum 安装</span></span><br><span class="line">yum install cifs-utils -y</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rpm包安装</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载一个cifs-utils的rpm包</span></span><br><span class="line">rpm -ivh --nodeps cifs-utils.rpm</span><br></pre></td></tr></table></figure><h4 id="Debian系"><a href="#Debian系" class="headerlink" title="Debian系"></a>Debian系</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">apt 安装</span></span><br><span class="line">apt install cifs-utils</span><br></pre></td></tr></table></figure><h3 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h3><h4 id="创建用户名密码配置文件"><a href="#创建用户名密码配置文件" class="headerlink" title="创建用户名密码配置文件"></a>创建用户名密码配置文件</h4><p>在<code>/etc</code>下创建<code>samba.config</code>文件，文件内容如下：</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 你自己nas网盘的用户名和密码</span></span><br><span class="line"><span class="attr">username</span>=用户名</span><br><span class="line"><span class="attr">password</span>=密码</span><br></pre></td></tr></table></figure><p>注：文件名和文件地址不一定要和我的一样，只要下面挂载命令里统一即可</p><h4 id="挂载网盘"><a href="#挂载网盘" class="headerlink" title="挂载网盘"></a>挂载网盘</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建挂载文件夹</span></span><br><span class="line">mkdir /samba_share</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在/etc/fstab文件加入下一行代码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0.0.0.0 替换成自己的IP</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/nas 替换成自己的网盘共享文件夹地址</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/samba_share 和本地文件夹地址相同</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/samba.config 用户名密码的配置文件地址</span></span><br><span class="line">//0.0.0.0/nas /samba_share cifs rw,credentials=/etc/samba.config,gid=0,uid=0,rw,iocharset=utf8,file_mode=0777,dir_mode=0777 0 0</span><br></pre></td></tr></table></figure><p>注：该方式挂载后，系统启动后就能自动挂载，但如此配置不好，可能导致系统启动不了，需用引导系统进入系统才能修改该文件，如果临时用可以用mount 命令挂载，命令如下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount.cifs  //10.10.10.1/nas  /home/nas/  -o username=gz,domain=nas,password=123456,sec=ntlmssp,iocharset=utf8</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">mount -t cifs -o  username=gz,domain=nas,password=123456,sec=ntlmssp,iocharset=utf8   //10.10.10.1/nas  /home/nas/ </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果挂载不上，无反应，就在参数上添加vers=2.0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令参数解析：</span></span><br><span class="line">mount                         #挂载命令</span><br><span class="line">-t                            #挂载文件系统的类型，通常不必指定。mount会自动选择正确的类型(nas有两种格式：nfs、cifs)</span><br><span class="line">-o iocharset=utf8             [options 主要用来描述设备或档案的挂接方式，\ 参数iocharset表示指定访问文件系统所用字符集。\ 路径中如有中文则添加此项，支持中文路径]</span><br><span class="line">sername=gz                    [nas用户名]</span><br><span class="line">Domain=nas                    [域名]</span><br><span class="line">password=123456               [nas密码]     </span><br><span class="line">//10.10.10.1/nas              [nas路径]</span><br><span class="line">/home/nas/                    [挂载路径]</span><br><span class="line">sec=ntlmssp                   [NTLMSSP (NT LAN Manager Security Support Provider)，是微软提供的安全支持接口协议]</span><br></pre></td></tr></table></figure><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>mount命令挂载参考以下文章，该方式本人没尝试过</p><p><a href="https://blog.csdn.net/weixin_39724395/article/details/123429188">https://blog.csdn.net/weixin_39724395/article/details/123429188</a> </p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络硬盘 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自建镜像仓库</title>
      <link href="//docker/docker-registry.html"/>
      <url>//docker/docker-registry.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>目前国内把docker镜像仓库墙了，很多服务器要更新新的镜像都要用本地导入的方式更新镜像，多台服务器用起来就很麻烦，同样的，家里的nas群晖也没办法很好的用docker了，为了以后方便，又因为自己博客网站服务器就在香港，可以用这个服务器搭建一个私人镜像仓库。</p><hr><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul><li>服务器：centos7服务器 -1核2G，40G硬盘（自己用，目前还不用扩充硬盘）</li><li>docker镜像：docker.io/library/registry:latest</li></ul><h3 id="搭建服务端"><a href="#搭建服务端" class="headerlink" title="搭建服务端"></a>搭建服务端</h3><h4 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure><h4 id="创建相关文件夹"><a href="#创建相关文件夹" class="headerlink" title="创建相关文件夹"></a>创建相关文件夹</h4><p>本人项目放在<code>/data/docker-space/docker-registry-deploy</code>文件夹下，以下所有涉及到文件和文件夹相关的命令都是已该文件夹为根目录。</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir auth config data</span><br></pre></td></tr></table></figure><p>注：<code>auth</code>文件夹存放加密的用户名密码文件<code>htpasswd</code>，<code>config</code>文件夹存放容器的配置文件<code>config.yml</code>，<code>data</code>文件夹挂载上传的镜像文件。</p><h4 id="创建用户加密文件：htpasswd"><a href="#创建用户加密文件：htpasswd" class="headerlink" title="创建用户加密文件：htpasswd"></a>创建用户加密文件：htpasswd</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --entrypoint htpasswd registry:latest -Bbn name password123  &gt; ./auth/htpasswd</span><br></pre></td></tr></table></figure><p>注：以上方式我这边报以下错误:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker: Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: &quot;htpasswd&quot;: executable file not found in $PATH: unknown.</span><br></pre></td></tr></table></figure><p>本人查询到别的处理方式是安装httpd，用该软件创建加密文件</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、安装httpd软件</span></span><br><span class="line">yum install httpd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、用该软件创建用户密码加密文件</span></span><br><span class="line">htpasswd -Bbn test 123456  &gt; auth/htpasswd</span><br></pre></td></tr></table></figure><h4 id="编写配置文件：config-yml"><a href="#编写配置文件：config-yml" class="headerlink" title="编写配置文件：config.yml"></a>编写配置文件：config.yml</h4><p>配置文件内容如下：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">0.1</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line">  <span class="attr">fields:</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">registry</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">delete:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">blobdescriptor:</span> <span class="string">inmemory</span></span><br><span class="line">  <span class="attr">filesystem:</span></span><br><span class="line">    <span class="attr">rootdirectory:</span> <span class="string">/var/lib/registry</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line">  <span class="attr">addr:</span> <span class="string">:5000</span></span><br><span class="line">  <span class="attr">headers:</span></span><br><span class="line">    <span class="attr">X-Content-Type-Options:</span> [<span class="string">nosniff</span>]</span><br><span class="line"><span class="attr">health:</span></span><br><span class="line">  <span class="attr">storagedriver:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line"><span class="attr">threshold:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="启动创建与运行脚本"><a href="#启动创建与运行脚本" class="headerlink" title="启动创建与运行脚本"></a>启动创建与运行脚本</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart=always  --name=registry \</span><br><span class="line">-v $PWD/config/:/etc/docker/registry/ \</span><br><span class="line">-v $PWD/auth/:/auth/ \</span><br><span class="line">-e &quot;REGISTRY_AUTH=htpasswd&quot; \</span><br><span class="line">-e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; \</span><br><span class="line">-e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \</span><br><span class="line">-v $PWD/data/:/var/lib/registry/ \</span><br><span class="line">registry:latest</span><br></pre></td></tr></table></figure><h4 id="验证服务可用性"><a href="#验证服务可用性" class="headerlink" title="验证服务可用性"></a>验证服务可用性</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">无认证的私有仓库：</span></span><br><span class="line">curl -X GET http://ip:port/v2/_catalog</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">带认证的私有仓库</span></span><br><span class="line">curl -u username:password -X GET http://ip:port/v2/_catalog</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">带认证的不带-u参数，因验证不通过会报如下错误：</span></span><br><span class="line">&#123;&quot;errors&quot;:[&#123;&quot;code&quot;:&quot;UNAUTHORIZED&quot;,&quot;message&quot;:&quot;authentication required&quot;,&quot;detail&quot;:[&#123;&quot;Type&quot;:&quot;registry&quot;,&quot;Class&quot;:&quot;&quot;,&quot;Name&quot;:&quot;catalog&quot;,&quot;Action&quot;:&quot;*&quot;&#125;]&#125;]&#125;</span><br></pre></td></tr></table></figure><h3 id="客户端设置"><a href="#客户端设置" class="headerlink" title="客户端设置"></a>客户端设置</h3><p>编辑 <code>/etc/docker/deamon.json</code>文件（如果没有自己创建该文件）,添加以下内容</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&#123;&quot;insecure-registries&quot;:[&quot;http://ip:port&quot;,&quot;http://ip&quot;]&#125;</span><br></pre></td></tr></table></figure><p>说明：把IP改成服务器IP，端口一般是5000</p><p>重启docker服务，命令如下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新配置</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><p>在群晖ContainerManager 插件中要改以下文件：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /var/packages/ContainerManager/etc/dockerd.json</span><br></pre></td></tr></table></figure><p>然后重启插件</p><h3 id="清理仓库镜像"><a href="#清理仓库镜像" class="headerlink" title="清理仓库镜像"></a>清理仓库镜像</h3><p>这个我得回去找找，以前不写博客，写过一个清理脚本，不知道还能不能找回来。</p><hr><p><del>参考</del>抄袭文章：</p><p><a href="https://blog.csdn.net/qq_38637558/article/details/99603071">搭建docker私有仓库 配置用户名密码</a></p><p><a href="https://blog.csdn.net/m0_61209018/article/details/121698444">docker 私人仓库 设置密码报错（已解决）</a></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>系统操作日志相关</title>
      <link href="//linux/log.html"/>
      <url>//linux/log.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>linux系统的一些日志系统整理。</p><hr><h3 id="查看用户操作日志"><a href="#查看用户操作日志" class="headerlink" title="查看用户操作日志"></a>查看用户操作日志</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">last#查看最近登录的账户的信息</span><br><span class="line">lastlog#查看所有账户的最近一次登录信息</span><br></pre></td></tr></table></figure><h3 id="查看用户的操作记录-：-到用户家目录下查看-bash-history文件"><a href="#查看用户的操作记录-：-到用户家目录下查看-bash-history文件" class="headerlink" title="查看用户的操作记录 ： 到用户家目录下查看.bash_history文件"></a>查看用户的操作记录 ： 到用户家目录下查看.bash_history文件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /home/&#123;username&#125;/.bash_history</span><br></pre></td></tr></table></figure><h3 id="设置操作记录时间格式"><a href="#设置操作记录时间格式" class="headerlink" title="设置操作记录时间格式"></a>设置操作记录时间格式</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;export HISTTIMEFORMAT=&quot;%Y-%m-%d %H:%M:%S &quot;&#x27; &gt;&gt; /etc/bash.bashrc </span><br><span class="line">echo &#x27;export HISTSIZE=-1&#x27; &gt;&gt; /etc/bash.bashrc # -1为保存所有</span><br><span class="line">echo &#x27;HISTTIMEFORMAT=&quot;%F %T &quot;&#x27; &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql主从设置</title>
      <link href="//db/mysql-master-slave.html"/>
      <url>//db/mysql-master-slave.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>公司服务器迁徙之后，因为数据库数据量太大，用备份的数据恢复到从库的方式过于耗费时间，再加上数据库本就是docker方式启动的，以前只是按照文档一步步搭建主从数据库，今天有时间就好好研究一下原理，记录一下偷懒时遇到的问题。</p><h3 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a>搭建过程</h3><p>注：本方案是为了应对公司项目做的处理，所以处理方式有些偏向与容器化部署项目的记录方案，比如公司本有一台运行中的docker mysql数据库，扩容另台或多台从数据库时可用该方案。</p><h4 id="备份主库挂载文件夹到从库服务器"><a href="#备份主库挂载文件夹到从库服务器" class="headerlink" title="备份主库挂载文件夹到从库服务器"></a>备份主库挂载文件夹到从库服务器</h4><p>备份文件夹时最好先停止docker容器，或锁表：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">flush tables <span class="keyword">with</span> read lock</span><br></pre></td></tr></table></figure><p>备份完成，再恢复数据写入：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">unlock tables</span><br></pre></td></tr></table></figure><h4 id="如有设置过主从，删除相关表数据，重置设置"><a href="#如有设置过主从，删除相关表数据，重置设置" class="headerlink" title="如有设置过主从，删除相关表数据，重置设置"></a>如有设置过主从，删除相关表数据，重置设置</h4><p>截断<code>mysql</code>数据库下的<code>slave_master_info</code>和<code>slave_relay_log_info</code>两个表</p><p><img src="https://images.jzwfan.com/image/2024/07/12/174758-0.png" alt="image-20240712174756001"></p><p>删除挂载出来的文件夹下的所有<code>relay log</code> 文件（注：挂载出来的为<code>/var/lib/mysql</code>文件夹）</p><p><img src="https://images.jzwfan.com/image/2024/07/12/175817-0.png" alt="image-20240712175814774"></p><p>数据库中运行以下命令重置状态</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">reset slave;</span><br></pre></td></tr></table></figure><h4 id="更新备库的server-uuid"><a href="#更新备库的server-uuid" class="headerlink" title="更新备库的server-uuid"></a>更新备库的server-uuid</h4><p>主库和从库的server-uuid不能相同，这里是直接拷贝文件，所以要手动改配置。用以下命令获取UUID</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> UUID();</span><br></pre></td></tr></table></figure><p><img src="https://images.jzwfan.com/image/2024/07/15/100910-0.png" alt="image-20240715100907937"></p><p>更新<code>auto.cnf</code>文件中的<code>server-uuid</code>设置（注：挂载出来的为<code>/var/lib/mysql</code>文件夹）</p><p><img src="https://images.jzwfan.com/image/2024/07/15/101813-0.png" alt="image-20240715101804553"></p><h4 id="my-cnf文件配置"><a href="#my-cnf文件配置" class="headerlink" title="my.cnf文件配置"></a>my.cnf文件配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">datadir = /usr/local/mysql/data</span><br><span class="line">pid-file = /usr/local/mysql/data/mysql.pid</span><br><span class="line">log-error = /usr/local/mysql/data/mysql.err</span><br><span class="line"></span><br><span class="line">server-id = 1 #另一个改成2</span><br><span class="line">auto_increment_offset = 1#奇数ID，另一个改成偶数ID</span><br><span class="line">auto_increment_increment = 2                                            #ID生成步长改成2</span><br><span class="line"></span><br><span class="line">log-bin = mysql-bin                                                     #打开二进制功能,MASTER主服务器必须打开此项</span><br><span class="line">binlog-format=ROW</span><br><span class="line"># binlog-row-p_w_picpath=minimal</span><br><span class="line">#将复制事件写入binlog,一台服务器既做主库又做从库此选项必须要开启</span><br><span class="line">log-slave-updates=true</span><br><span class="line">gtid-mode=on</span><br><span class="line">enforce-gtid-consistency=true</span><br><span class="line">master-info-repository=TABLE</span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line">sync-master-info=1</span><br><span class="line">slave-parallel-workers=0</span><br><span class="line">sync_binlog=0</span><br><span class="line">binlog-checksum=CRC32</span><br><span class="line">master-verify-checksum=1</span><br><span class="line">slave-sql-verify-checksum=1</span><br><span class="line">binlog-rows-query-log_events=1</span><br><span class="line">#expire_logs_days=5</span><br><span class="line">max_binlog_size=1024M                                                   #binlog单文件最大值</span><br><span class="line"></span><br><span class="line">replicate-ignore-db = mysql                                             #忽略不同步主从的数据库</span><br><span class="line">replicate-ignore-db = information_schema</span><br><span class="line">replicate-ignore-db = performance_schema</span><br><span class="line">replicate-ignore-db = test</span><br><span class="line">replicate-ignore-db = zabbix</span><br><span class="line"></span><br><span class="line">max_connections = 3000</span><br><span class="line">max_connect_errors = 30</span><br><span class="line"></span><br><span class="line">skip-character-set-client-handshake                                     #忽略应用程序想要设置的其他字符集</span><br><span class="line">init-connect=&#x27;SET NAMES utf8&#x27;                                           #连接时执行的SQL</span><br><span class="line">character-set-server=utf8                                               #服务端默认字符集</span><br><span class="line">wait_timeout=1800                                                       #请求的最大连接时间</span><br><span class="line">interactive_timeout=1800                                                #和上一参数同时修改才会生效</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES                     #sql模式</span><br><span class="line">max_allowed_packet = 10M</span><br><span class="line">bulk_insert_buffer_size = 8M</span><br><span class="line">query_cache_type = 1</span><br><span class="line">query_cache_size = 128M</span><br><span class="line">query_cache_limit = 4M</span><br><span class="line">key_buffer_size = 256M</span><br><span class="line">read_buffer_size = 16K</span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br><span class="line">slow_query_log=1</span><br><span class="line">long_query_time = 6</span><br><span class="line">slow_query_log_file=slow-query.log</span><br><span class="line">innodb_flush_log_at_trx_commit = 2</span><br><span class="line">innodb_log_buffer_size = 16M</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size = 20M</span><br><span class="line">sort_buffer_size = 20M</span><br><span class="line">read_buffer = 2M</span><br><span class="line">write_buffer = 2M</span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 16M</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br></pre></td></tr></table></figure><h4 id="添加主从同步账户"><a href="#添加主从同步账户" class="headerlink" title="添加主从同步账户"></a>添加主从同步账户</h4><p>master0</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;master1-ip&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>master1</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;master0-ip&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>注：为了数据安全，用户最好指定IP而非<code>%</code></p><h4 id="查看两个数据库的master状态"><a href="#查看两个数据库的master状态" class="headerlink" title="查看两个数据库的master状态"></a>查看两个数据库的master状态</h4><p>命令如下：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure><p>返回如下图所示，记住被框住的两个数据，后面有用：</p><p><img src="https://images.jzwfan.com/image/2024/07/15/104554-0.png" alt="image-20240715104551372"></p><h4 id="配置同步信息"><a href="#配置同步信息" class="headerlink" title="配置同步信息"></a>配置同步信息</h4><p>Master0命令如下：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">change master <span class="keyword">to</span></span><br><span class="line">master_host<span class="operator">=</span><span class="string">&#x27;master1-ip&#x27;</span>, # 指定IP</span><br><span class="line">master_port<span class="operator">=</span><span class="number">3306</span>, # 指定端口</span><br><span class="line">master_user<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>, # 指定用户名</span><br><span class="line">master_password<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>, # 指定用户名字</span><br><span class="line">master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-master1-bin.000001&#x27;</span>, # 指定上一步中返回文件名</span><br><span class="line">master_log_pos<span class="operator">=</span><span class="number">582</span>; # 指定上一步中返回的步数</span><br></pre></td></tr></table></figure><p>然后启动主从:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure><p>查看状态：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> slave status\G # 注：这里没有分号</span><br></pre></td></tr></table></figure><p>显示如下图：</p><p><img src="https://images.jzwfan.com/image/2024/07/15/110015-0.png" alt="image-20240715110013349"></p><p>然后在master1上重复此步骤。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>如果以前做过主从，要清理主从配置</li><li>如果不是导入的，而是和我一样直接复制docker挂载的文件夹时要改server-uuid</li></ul><p>参考地址：</p><p><a href="https://www.cnblogs.com/ygqygq2/p/6045279.html">https://www.cnblogs.com/ygqygq2/p/6045279.html</a></p><p><a href="https://www.jianshu.com/p/805dc6576b79">https://www.jianshu.com/p/805dc6576b79</a></p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>yum换源</title>
      <link href="//linux/yum-change-source.html"/>
      <url>//linux/yum-change-source.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>使用yum的官方源进行yum install xxxx 的时候，速度非常慢，只有几kB/s，有时候还不到1kB/s。这就会造成安装包的速度的速度要么特变慢，要么就根本安装不了。</p><hr><h3 id="更新源"><a href="#更新源" class="headerlink" title="更新源"></a>更新源</h3><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br></pre></td></tr></table></figure><h4 id="下载新的-CentOS-Base-repo-到-etc-yum-repos-d"><a href="#下载新的-CentOS-Base-repo-到-etc-yum-repos-d" class="headerlink" title="下载新的 CentOS-Base.repo 到 /etc/yum.repos.d/"></a>下载新的 CentOS-Base.repo 到 /etc/yum.repos.d/</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos6</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centos7</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>注：如果没有安装<code>wget</code>，可本地访问网址下载，上传到服务器。</p><h4 id="清理并生成新的缓存"><a href="#清理并生成新的缓存" class="headerlink" title="清理并生成新的缓存"></a>清理并生成新的缓存</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum clean &amp; yum makecache</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>有时候可能阿里源不可用，可替换清华源等。</p><p>原地址：<a href="https://blog.csdn.net/wudinaniya/article/details/105758739">https://blog.csdn.net/wudinaniya/article/details/105758739</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>达梦数据导入导出</title>
      <link href="//db/dimp-and-dexp.html"/>
      <url>//db/dimp-and-dexp.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>达梦数据库导出导入工具使用说明。备注，此备份还原方案是逻辑操作，在少量数据的情况下，性能足够，一旦数据量过大，则备份时间极长。</p><h3 id="同步方式"><a href="#同步方式" class="headerlink" title="同步方式"></a>同步方式</h3><p>达梦数据库支持4种数据同步方式，这些方式可以根据特定的场景去使用。</p><ul><li>FULL（全库）</li><li>OWNER（用户）</li><li>SCHEMAS（模式）</li><li>TABLES（表）</li></ul><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><table class="data-table" data-transient-attributes="class"    style="width: 100%; outline: none; border-collapse: collapse;" data-width="576px">    <colgroup>        <col span="1" width="144">        <col span="1" width="144">        <col span="1" width="144">        <col span="1" width="144">    </colgroup>    <tbody>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>参数<br></p>            </td>            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>dexp说明<br></p>            </td>            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>dimp说明<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>备注<br></p>            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>USERID<br></p>            </td>            <td colspan="2" data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>USERID在作为导出和导入时，都是指定一个链接串。格式为：用户名/密码@库名:端口号#证书路径<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>FILE<br></p>            </td>            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>file作为导出参数时，指定导出的文件名。可选参数，默认值为dexp.dmp<br></p>            </td>            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>fiel作为导入参数时，指定导入使用的文件名，也就是dexp导出的文件。作为导入时，它是必选参数。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>DIRECTORY<br></p>            </td>            <td colspan="2" data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>directory参数指定导出和导入的目录，简单点说就是指定dmp(转储文件)的位置。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>FULL<br></p>            </td>            <td colspan="2" data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>full参数指定导出和导入基于整个数据库，也就是导出整个数据库或导入整个数据库。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>四种方式之一，不建议使用。<br></p>            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>OWNER<br></p>            </td>            <td colspan="2" data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>owner参数指定导出和导入基于用户，也就是导出或导入用户中的所有对象，多个用户使用英文逗号分割。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>四种方式之一，根据需要使用，用户与模式基本一致。<br></p>            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>SCHEMAS<br></p>            </td>            <td colspan="2" data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>schemas参数指定导出和导入基于模式，也就是导出或导入模式下的所有对象，多个模式使用英文逗号分割<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>四种方式之一，根据需要使用，模式与用户基本一致。<br></p>            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>TABLES<br></p>            </td>            <td colspan="2" data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>tables参数指定导出和导入基于表，也就是导出或导入表的结构和数据，多个表使用英文逗号分割。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>四种方式之一，根据需要使用<br></p>            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>PARALLEL<br></p>            </td>            <td colspan="2" data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>parallel参数指定导出和导入过程中使用的线程数。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>COMPRESS<br></p>            </td>            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>compress参数指定导出的数据是否压缩，默认值N(不压缩)，可选值Y|N。<br></p>            </td>            <td data-transient-attributes="table-cell-selection"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>无<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">            </td>        </tr>        <tr style="height: 30px;">            <td data-transient-attributes="table-cell-selection" class="table-last-column"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>LOG<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-column"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>log作为导出参数时，指定导出日志的文件名。可选参数，默认值为dexp.log。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-column"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">                <p>log作为导入参数时，指定导入日志的文件名。可选参数，默认值为dimp.log。<br></p>            </td>            <td data-transient-attributes="table-cell-selection" class="table-last-column table-last-row"                style="min-width: auto; overflow-wrap: break-word; margin: 4px 8px; border: 1px solid rgb(217, 217, 217); padding: 4px 8px; cursor: default; vertical-align: top;">            </td>        </tr>    </tbody></table><h3 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h3><p>这里只记录了备份还原模式的用法，其他用法可看原文档</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 备份</span><br><span class="line">.<span class="operator">/</span>dexp SYSDBA<span class="operator">/</span>SYSDBA001<span class="variable">@127</span><span class="number">.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5236</span> FILE<span class="operator">=</span>SZSQ.dmp LOG<span class="operator">=</span>SZSQ.log DIRECTORY<span class="operator">=</span><span class="operator">/</span>data SCHEMAS<span class="operator">=</span>SZSQ</span><br><span class="line"># 还原，还原之前要删除相应表数据</span><br><span class="line">.<span class="operator">/</span>dimp SYSDBA<span class="operator">/</span>SYSDBA001<span class="variable">@127</span><span class="number">.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5236</span> FILE<span class="operator">=</span>SZSQ.dmp LOG<span class="operator">=</span>SZSQ.log DIRECTORY<span class="operator">=</span><span class="operator">/</span>data SCHEMAS<span class="operator">=</span>SZSQ</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>原地址：<a href="https://blog.51cto.com/bxbdba/7175810">https://blog.51cto.com/bxbdba/7175810</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>防火墙设置</title>
      <link href="//linux/firewall-cmd.html"/>
      <url>//linux/firewall-cmd.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>记录一下Linux下的firewall-cmd命令的用法，以后慢慢更新，慢慢完善。</p><hr><h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><h4 id="查看防火墙状态"><a href="#查看防火墙状态" class="headerlink" title="查看防火墙状态"></a>查看防火墙状态</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看防火墙状态</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启防火墙</span></span><br><span class="line">systemctl start firewalld</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开机启动</span></span><br><span class="line">systemctl enable firewalld</span><br></pre></td></tr></table></figure><h4 id="端口访问设置"><a href="#端口访问设置" class="headerlink" title="端口访问设置"></a>端口访问设置</h4><p>查看已开放的端口、IP规则</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询打开的端口</span></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure><p>开放新端口，默认情况下所有端口都是关闭状态</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开放端口9001/tcp (tcp、udp等)</span></span><br><span class="line">firewall-cmd --zone=public --add-port=9001/tcp --add-port=9001/udp --permanent</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">批量开放9002～9005的tcp端口</span></span><br><span class="line">firewall-cmd --zone=public --add-port=9002-9005/tcp --permanent</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新载入防火墙设置，使设置生效</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>关闭已开放的端口</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭端口9001/tcp (tcp、udp等)</span></span><br><span class="line">firewall-cmd --zone=public --remove-port=9001/tcp --add-port=9001/udp --permanent</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">批量关闭9002～9005的tcp端口</span></span><br><span class="line">firewall-cmd --zone=public --remove-port=9002-9005/tcp --permanent</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新载入防火墙设置，使设置生效</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h4 id="IP访问设置"><a href="#IP访问设置" class="headerlink" title="IP访问设置"></a>IP访问设置</h4><p>查看已设置的规则</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看已设置的规则</span></span><br><span class="line">firewall-cmd --zone=public --list-rich-rules</span><br></pre></td></tr></table></figure><p>开放或限制ip（设置规则）</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开放IPV4地址为：192.168.0.0 指定端口：9001/tcp</span></span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.0.0&quot; port protocol=&quot;tcp&quot; port=&quot;9001&quot; accept&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开放IPV4地址为：192.168.0.1，不指定端口，代表可以访问所有端口（是否可以访问未开放端口待验证）</span></span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.0.1&quot; accept&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">限制IPV4地址为：192.168.1.0</span></span><br><span class="line">firewall-cmd --permanent --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.0&quot; reject&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新载入防火墙设置，使设置生效</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>删除已设置的规则</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除开放IPV4地址为：192.168.0.0 指定端口：9001/tcp</span></span><br><span class="line">firewall-cmd --permanent --remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.0.0&quot; port protocol=&quot;tcp&quot; port=&quot;9001&quot; accept&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除开放IPV4地址为：192.168.0.1，不指定端口，代表可以访问所有端口（是否可以访问未开放端口待验证）</span></span><br><span class="line">firewall-cmd --permanent --remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.0.1&quot; accept&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除限制IPV4地址为：192.168.1.0</span></span><br><span class="line">firewall-cmd --permanent --remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.0&quot; reject&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新载入防火墙设置，使设置生效</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h4 id="如设置未生效，可尝试直接编辑规则文件，删掉原来的设置规则，重新载入一下防火墙即可"><a href="#如设置未生效，可尝试直接编辑规则文件，删掉原来的设置规则，重新载入一下防火墙即可" class="headerlink" title="如设置未生效，可尝试直接编辑规则文件，删掉原来的设置规则，重新载入一下防火墙即可"></a>如设置未生效，可尝试直接编辑规则文件，删掉原来的设置规则，重新载入一下防火墙即可</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/firewalld/zones/public.xml</span><br></pre></td></tr></table></figure><h3 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h3><p><a href="https://blog.csdn.net/haoqi9999/article/details/125988881">https://blog.csdn.net/haoqi9999/article/details/125988881</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 防火墙 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>List对象排序</title>
      <link href="//java/collections-sort.html"/>
      <url>//java/collections-sort.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>记一下Java中List对象的三种排序方式，万一用得着呢（已经用着了）。</p><hr><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>简单对象排序，如Integer对象，String对象等，代码如下：</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 调用Collections.sort 方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; integerList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        integerList.add(<span class="number">9</span>);</span><br><span class="line">        integerList.add(<span class="number">4</span>);</span><br><span class="line">        integerList.add(<span class="number">6</span>);</span><br><span class="line">        integerList.add(<span class="number">1</span>);</span><br><span class="line">        integerList.add(<span class="number">8</span>);</span><br><span class="line">        integerList.add(<span class="number">7</span>);</span><br><span class="line">        integerList.add(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 默认升序</span></span><br><span class="line">        Collections.sort(integerList);</span><br><span class="line">        <span class="keyword">for</span> (Integer i : integerList)&#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 设置为降序</span></span><br><span class="line">        Collections.sort(integerList,Collections.reverseOrder());</span><br><span class="line">        <span class="keyword">for</span> (Integer i : integerList)&#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 调用List.sort()方法，传入对象compareTo方法，一般不用该方法排序简单对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; integerList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        integerList.add(<span class="number">9</span>);</span><br><span class="line">        integerList.add(<span class="number">4</span>);</span><br><span class="line">        integerList.add(<span class="number">6</span>);</span><br><span class="line">        integerList.add(<span class="number">1</span>);</span><br><span class="line">        integerList.add(<span class="number">8</span>);</span><br><span class="line">        integerList.add(<span class="number">7</span>);</span><br><span class="line">        integerList.add(<span class="number">5</span>);</span><br><span class="line">        integerList.sort(Integer::compareTo); <span class="comment">//方法名可以自定义，建议遵循java命名规则</span></span><br><span class="line">        <span class="keyword">for</span> (Integer i : integerList)&#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>自定义对象排序，可重写compareTo方法排序</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; integerList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;m&quot;</span>,<span class="number">9</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;j&quot;</span>,<span class="number">4</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;y&quot;</span>,<span class="number">6</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;q&quot;</span>,<span class="number">1</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;i&quot;</span>,<span class="number">8</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;b&quot;</span>,<span class="number">7</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;d&quot;</span>,<span class="number">5</span>));</span><br><span class="line">        integerList.sort(User::compareTo);</span><br><span class="line">        <span class="keyword">for</span> (User i : integerList)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;name:&quot;</span> + i.getName() + <span class="string">&quot;,sex:&quot;</span> + i.getSex());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, Integer sex)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(User user)</span>&#123;</span><br><span class="line">      <span class="comment">// 这里设置为升序，</span></span><br><span class="line">      <span class="comment">// 降序写法替换顺序：user.getSex().compareTo(this.getSex()); </span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getSex().compareTo(user.getSex()); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getSex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSex</span><span class="params">(Integer sex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方案三"><a href="#方案三" class="headerlink" title="方案三"></a>方案三</h3><p>用匿名函数重写排序方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; integerList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;m&quot;</span>,<span class="number">9</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;j&quot;</span>,<span class="number">4</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;y&quot;</span>,<span class="number">6</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;q&quot;</span>,<span class="number">1</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;i&quot;</span>,<span class="number">8</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;b&quot;</span>,<span class="number">7</span>));</span><br><span class="line">        integerList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;d&quot;</span>,<span class="number">5</span>));</span><br><span class="line">        integerList.sort(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;User&gt;() &#123; <span class="comment">// 这个在java8中可以用表达式写：(t1,t2) -&gt; t1.getSex() &gt;= t2.getSex() ? 1 : -1;</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(User o1, User o2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o1.getSex() &gt;= o2.getSex() ? <span class="number">1</span> : -<span class="number">1</span>; <span class="comment">//这里升序为1:-1，降序为-1:1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span> (User i : integerList)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;name:&quot;</span> + i.getName() + <span class="string">&quot;,sex:&quot;</span> + i.getSex());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, Integer sex)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user.getSex().compareTo(<span class="built_in">this</span>.getSex());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getSex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSex</span><span class="params">(Integer sex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> list </tag>
            
            <tag> sort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css实用代码合集</title>
      <link href="//html/practical-css.html"/>
      <url>//html/practical-css.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>记录一些在工作和写博客中遇到的一些CSS代码场景,可能这些用的不多，以后也很敢再遇到新的逻辑代码,但总要养成遇到就要记录的习惯。</p><h3 id="img图片保持比例且居中显示"><a href="#img图片保持比例且居中显示" class="headerlink" title="img图片保持比例且居中显示"></a>img图片保持比例且居中显示</h3><p> 外部容器设置 固定宽度高度，设置line-height与height相等（垂直居中），设置text-align是center(水平居中)，内部img设置style（max-height:100%;max-width:100%;vertical-align: middle; <a href="https://so.csdn.net/so/search?q=margin&amp;spm=1001.2101.3001.7020">margin</a>: 0 auto;）。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 398px;height: 298px;line-height: 298px;text-align: center;border:1px solid #E09972&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;test.jpg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;max-width:100%;max-height:100%;vertical-align: middle; margin: 0 auto;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>源地址：<a href="https://blog.csdn.net/shijie_nihao/article/details/106348591">https://blog.csdn.net/shijie_nihao/article/details/106348591</a></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sql语句</title>
      <link href="//db/sql.html"/>
      <url>//db/sql.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>工作中遇到的SQL查询方法、语法、和优化记录。</p><hr><h3 id="SQL-方法和关键字"><a href="#SQL-方法和关键字" class="headerlink" title="SQL 方法和关键字"></a>SQL 方法和关键字</h3><h4 id="GROUP-COUNT-WM-COUNT"><a href="#GROUP-COUNT-WM-COUNT" class="headerlink" title="GROUP_COUNT\WM_COUNT"></a>GROUP_COUNT\WM_COUNT</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># mysql group_concat</span><br><span class="line"># separator 用来替换拼接字段， eg: 水果<span class="operator">-</span>素菜</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">group_concat(c.category_name separator <span class="string">&#x27;-&#x27;</span>) category_name,</span><br><span class="line">cs.store_id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">dt_category_store <span class="keyword">as</span> cs</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line">dt_category <span class="keyword">as</span> c</span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">cs.category_id <span class="operator">=</span> c.category_id <span class="keyword">and</span> cs.category_type <span class="operator">=</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cs.store_id</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># dm wm_concat 方式</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">wm_concat(c.category_name) category_name,</span><br><span class="line">cs.store_id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">dt_category_store <span class="keyword">as</span> cs</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line">dt_category <span class="keyword">as</span> c</span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">cs.category_id <span class="operator">=</span> c.category_id <span class="keyword">and</span> cs.category_type <span class="operator">=</span> <span class="number">6</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cs.store_id</span><br></pre></td></tr></table></figure><h4 id="LEFT（从左开始截取字符串）"><a href="#LEFT（从左开始截取字符串）" class="headerlink" title="LEFT（从左开始截取字符串）"></a>LEFT（从<strong>左</strong>开始截取字符串）</h4><p>用法：left(str, length)，即：left(被截取字符串， 截取长度)</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;www.jzwfan.com&#x27;</span>,<span class="number">8</span>)</span><br></pre></td></tr></table></figure><p>结果为：www.jzwf</p><h4 id="RIGHT-从右开始截取字符串"><a href="#RIGHT-从右开始截取字符串" class="headerlink" title="RIGHT(从右开始截取字符串)"></a>RIGHT(从<strong>右</strong>开始截取字符串)</h4><p>用法：right(str, length)，即：right(被截取字符串， 截取长度)</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">&#x27;www.jzwfan.com&#x27;</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure><p>结果为：an.com</p><h4 id="SUBSTRING-截取特定长度的字符串"><a href="#SUBSTRING-截取特定长度的字符串" class="headerlink" title="SUBSTRING(截取特定长度的字符串)"></a>SUBSTRING(截取<strong>特定长度</strong>的字符串)</h4><p>用法：</p><ul><li>substring(str, pos)，即：substring(被截取字符串， 从第几位开始截取)</li><li>substring(str, pos, length)，即：substring(被截取字符串，从第几位开始截取，截取长度)</li></ul><p>1.从字符串的第9个字符开始读取直至结束</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;www.jzwfan.com&#x27;</span>, <span class="number">9</span>)</span><br></pre></td></tr></table></figure><p>结果为：an.com</p><p>2.从字符串的第5个字符开始，只取3个字符</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;www.jzwfan.com&#x27;</span>, <span class="number">5</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>结果为：jzw</p><p>3.从字符串的倒数第6个字符开始读取直至结束</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;www.jzwfan.com&#x27;</span>, <span class="number">-6</span>)</span><br></pre></td></tr></table></figure><p>结果为：an.com</p><p>4.从字符串的倒数第6个字符开始读取，只取2个字符</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;www.jzwfan.com&#x27;</span>, <span class="number">-6</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>结果为：an</p><h4 id="SUBSTRING-INDEX-按关键字进行读取"><a href="#SUBSTRING-INDEX-按关键字进行读取" class="headerlink" title="SUBSTRING_INDEX(按关键字进行读取)"></a>SUBSTRING_INDEX(按<strong>关键字</strong>进行读取)</h4><p>用法：substring_index(str, delim, count)，即：substring_index(被截取字符串，关键字，关键字出现的次数)</p><p>1.截取第二个“.”之<strong>前</strong>的所有字符</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SUBSTRING_INDEX(<span class="string">&#x27;www.jzwfan.com&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>结果为：www.jzwfan</p><p>2.截取倒数第二个“.”之<strong>后</strong>的所有字符</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SUBSTRING_INDEX(<span class="string">&#x27;www.jzwfan.com&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="number">-2</span>);</span><br></pre></td></tr></table></figure><p>结果为：jzwfan.com</p><p>3.如果关键字不存在，则返回整个字符串</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SUBSTRING_INDEX(<span class="string">&#x27;www.yuanrengu.com&#x27;</span>, <span class="string">&#x27;sprite&#x27;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>结果为：www.jzwfan.com</p><p>以上，源地址：<a href="https://www.cnblogs.com/heyonggang/p/8117754.html">https://www.cnblogs.com/heyonggang/p/8117754.html</a></p><h4 id="FROM-UNIXTIME-时间戳格式化"><a href="#FROM-UNIXTIME-时间戳格式化" class="headerlink" title="FROM_UNIXTIME(时间戳格式化)"></a>FROM_UNIXTIME(时间戳格式化)</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># FROM_UNIXTIME(unix_timestamp, format)</span><br><span class="line"><span class="keyword">SELECT</span> FROM_UNIXTIME(<span class="number">1459338786</span>, <span class="string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>);</span><br></pre></td></tr></table></figure><p>format格式说明：</p><p>%M 月名字(January～December)<br>%W 星期名字(Sunday～Saturday)<br>%D 有英语前缀的月份的日期(1st, 2nd, 3rd, 等等。）<br>%Y 年, 数字, 4 位<br>%y 年, 数字, 2 位<br>%a 缩写的星期名字(Sun～Sat)<br>%d 月份中的天数, 数字(00～31)<br>%e 月份中的天数, 数字(0～31)<br>%m 月, 数字(01～12)<br>%c 月, 数字(1～12)<br>%b 缩写的月份名字(Jan～Dec)<br>%j 一年中的天数(001～366)<br>%H 小时(00～23)<br>%k 小时(0～23)<br>%h 小时(01～12)<br>%I 小时(01～12)<br>%l 小时(1～12)<br>%i 分钟, 数字(00～59)<br>%r 时间,12 小时(hh:mm:ss [AP]M)<br>%T 时间,24 小时(hh:mm:ss)<br>%S 秒(00～59)<br>%s 秒(00～59)<br>%p AM或PM<br>%w 一个星期中的天数(0=Sunday ～6=Saturday ）<br>%U 星期(0～52), 这里星期天是星期的第一天<br>%u 星期(0～52), 这里星期一是星期的第一天<br>%% 一个文字%</p><p>原地址：<a href="https://blog.csdn.net/fdipzone/article/details/51018930">https://blog.csdn.net/fdipzone/article/details/51018930</a></p><h4 id="DROP（删除表｜通用）"><a href="#DROP（删除表｜通用）" class="headerlink" title="DROP（删除表｜通用）"></a>DROP（删除表｜通用）</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># Mysql</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名;</span><br><span class="line"># DM</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 空间名.表名;</span><br></pre></td></tr></table></figure><h4 id="TRUNCATE（清空表数据｜通用）"><a href="#TRUNCATE（清空表数据｜通用）" class="headerlink" title="TRUNCATE（清空表数据｜通用）"></a>TRUNCATE（清空表数据｜通用）</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># Mysql</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> 表名;</span><br><span class="line"># DM</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> 空间名.表名;</span><br></pre></td></tr></table></figure><h3 id="SQL一些常用命令"><a href="#SQL一些常用命令" class="headerlink" title="SQL一些常用命令"></a>SQL一些常用命令</h3><h4 id="DM设置表主键是否自动递增"><a href="#DM设置表主键是否自动递增" class="headerlink" title="DM设置表主键是否自动递增"></a>DM设置表主键是否自动递增</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># OFF 开启， <span class="keyword">ON</span> 关闭</span><br><span class="line"><span class="keyword">SET</span> IDENTITY_INSERT 空间名.表名 <span class="keyword">ON</span>;</span><br></pre></td></tr></table></figure><h3 id="DM添加索引例子"><a href="#DM添加索引例子" class="headerlink" title="DM添加索引例子"></a>DM添加索引例子</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE  INDEX &quot;索引名&quot; <span class="keyword">ON</span> &quot;空间名&quot;.&quot;表名&quot;(&quot;列名1&quot; <span class="keyword">ASC</span>,&quot;列名2&quot; <span class="keyword">ASC</span>,&quot;列名3&quot; ASC...) STORAGE(<span class="keyword">ON</span> &quot;MAIN&quot;, CLUSTERBTR);</span><br></pre></td></tr></table></figure><h4 id="DM创建表语句模版"><a href="#DM创建表语句模版" class="headerlink" title="DM创建表语句模版"></a>DM创建表语句模版</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> &quot;空间名&quot;.&quot;表名&quot;</span><br><span class="line">(</span><br><span class="line">&quot;ID&quot; <span class="type">BIGINT</span> <span class="keyword">IDENTITY</span>(<span class="number">1</span>, <span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">&quot;NEIBH_ID&quot; <span class="type">BIGINT</span>,</span><br><span class="line">&quot;CATEGORY_ID&quot; <span class="type">BIGINT</span>,</span><br><span class="line">&quot;CATEGORY_TYPE&quot; <span class="type">VARCHAR</span>(<span class="number">2</span>),</span><br><span class="line">&quot;INSPECTOR_IDS&quot; <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&quot;INSPECTOR_NAMES&quot; <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&quot;TENANT_ID&quot; <span class="type">INT</span>,</span><br><span class="line">&quot;DELETED&quot; BIT <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">&quot;CREATOR&quot; <span class="type">INT</span>,</span><br><span class="line">&quot;CREATE_TIME&quot; <span class="type">TIMESTAMP</span>(<span class="number">0</span>),</span><br><span class="line">&quot;UPDATER&quot; <span class="type">INT</span>,</span><br><span class="line">&quot;UPDATE_TIME&quot; <span class="type">TIMESTAMP</span>(<span class="number">0</span>),</span><br><span class="line"><span class="keyword">NOT</span> CLUSTER <span class="keyword">PRIMARY</span> KEY(&quot;ID&quot;)) STORAGE(<span class="keyword">ON</span> &quot;MAIN&quot;, CLUSTERBTR) ;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> DM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis下Mapper文件例子</title>
      <link href="//db/mybatis-mapper.html"/>
      <url>//db/mybatis-mapper.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>记一下Mybatis的常用写法，其中也有一些mybatis-plus的写法文档。</p><hr><h3 id="choose-用法"><a href="#choose-用法" class="headerlink" title="choose 用法"></a>choose 用法</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;reqVo.inspectionType == 3&quot;</span>&gt;</span></span><br><span class="line">        SQL1...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;reqVo.inspectionType == 4&quot;</span>&gt;</span></span><br><span class="line">        SQL2...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        SQL3...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="foreach-用法"><a href="#foreach-用法" class="headerlink" title="foreach 用法"></a>foreach 用法</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;categoryIds&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;categoryId&quot;</span>&gt;</span></span><br><span class="line">    #&#123;categoryId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>域名自动化更新证书</title>
      <link href="//network/acme_sh.html"/>
      <url>//network/acme_sh.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>目前免费证书的使用期限是90天，证书更新也从以前的一年一换变成了现在的三个月一换，本人自己域名加公司域名有近四十个之多，每次证书更新都是一个很费事又费时的工作，不得不进行自动化处理。</p><hr><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装很简单，一个命令:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl https://get.acme.sh | sh -s email=my@example.com</span><br></pre></td></tr></table></figure><p>创建 一个 shell 的 alias，例如 .bashrc，方便你的使用: <code>alias acme.sh=~/.acme.sh/acme.sh</code>；</p><p>自动为你创建 cronjob,，每天 0:00 点自动检测所有的证书， 如果快过期了，需要更新，则会自动更新证书。</p><p>注：如果没有安装crontab，可在安装crontab之后加入以下任务：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0 0 * * * &quot;~/.acme.sh&quot;/acme.sh --cron --home &quot;~/.acme.sh&quot; &gt; /dev/null</span><br></pre></td></tr></table></figure><h3 id="更改服务地址"><a href="#更改服务地址" class="headerlink" title="更改服务地址"></a>更改服务地址</h3><p>acme.sh脚本默认ca服务器是zerossl，经常出错，会导致获取证书的时候一直出现：Pendi ng，The CA is processing your order,please just wait.</p><p>只需要把ca服务器改成letsencrypt 即可，虽然更改以后还是有概率出现pending，但基本2-3次即可成功。</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure><h3 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h3><p><strong>acme.sh</strong> 实现了 <strong>acme</strong> 协议支持的所有验证协议.，一般有两种方式验证: http 和 dns 验证。本人用的是http方式。</p><h4 id="http-方式需要在你的网站根目录下放置一个文件，来验证你的域名所有权-完成验证-然后就可以生成证书了。"><a href="#http-方式需要在你的网站根目录下放置一个文件，来验证你的域名所有权-完成验证-然后就可以生成证书了。" class="headerlink" title="http 方式需要在你的网站根目录下放置一个文件，来验证你的域名所有权,完成验证. 然后就可以生成证书了。"></a>http 方式需要在你的网站根目录下放置一个文件，来验证你的域名所有权,完成验证. 然后就可以生成证书了。</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注，这里多个-d只会生成一个证书文件夹，所以，只能是www和主域名两个域名可以这样放</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果是多个不同的二级域名，要每个单独执行一次</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">有可能出现curl不可用的情况，可以用 -- use-wget强制用wget替代curl</span></span><br><span class="line">acme.sh --issue -d mydomain.com --webroot /home/wwwroot/mydomain.com/</span><br></pre></td></tr></table></figure><p>只需要指定域名，并指定域名所在的网站根目录。 <strong>acme.sh</strong> 会全自动的生成验证文件， 并放到网站的根目录，然后自动完成验证。最后会聪明的删除验证文件， 整个过程没有任何副作用。</p><p>注：如果你还没有运行任何 web 服务，80 端口是空闲的，那么 acme.sh 还能假装自己是一个webserver，临时听在80 端口，完成验证:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">acme.sh --issue -d mydomain.com --standalone</span><br></pre></td></tr></table></figure><h4 id="安装证书"><a href="#安装证书" class="headerlink" title="安装证书"></a>安装证书</h4><p>前面证书生成以后，接下来需要把证书 copy 到真正需要用它的地方。</p><p>注：默认生成的证书都放在安装目录下: <code>~/.acme.sh/</code>，请不要直接使用此目录下的文件，例如: 不要直接让 nginx/apache 的配置文件使用这下面的文件. 这里面的文件都是内部使用，而且目录结构可能会变化。正确的使用方法是使用 <code>--install-cert</code> 命令，并指定目标位置，然后证书文件会被copy到相应的位置，例如:</p><h5 id="Apache-example"><a href="#Apache-example" class="headerlink" title="Apache example:"></a>Apache example:</h5><hr><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注：这个没试过，不过官网上文件后缀都写成了.pem，--reloadcmd 的命令也未测试</span></span><br><span class="line">acme.sh --install-cert -d example.com \</span><br><span class="line">--cert-file      /path/to/certfile/in/apache/cert.pem  \</span><br><span class="line">--key-file       /path/to/keyfile/in/apache/key.key  \</span><br><span class="line">--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \</span><br><span class="line">--reloadcmd     &quot;service apache2 force-reload&quot;</span><br></pre></td></tr></table></figure><h5 id="Nginx-example"><a href="#Nginx-example" class="headerlink" title="Nginx example:"></a>Nginx example:</h5><hr><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">网上文件后缀都写成了.pem，--reloadcmd 的命令改成nginx -s reload可用，</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果是docker，可改成 docker <span class="built_in">exec</span> -it 容器名 nginx -s reload</span> </span><br><span class="line">acme.sh --install-cert -d example.com \</span><br><span class="line">--key-file       /path/to/keyfile/in/nginx/key.key  \</span><br><span class="line">--fullchain-file /path/to/fullchain/nginx/cert.pem \</span><br><span class="line">--reloadcmd     &quot;nginx -s reload&quot;</span><br></pre></td></tr></table></figure><h4 id="查看已安装证书信息"><a href="#查看已安装证书信息" class="headerlink" title="查看已安装证书信息"></a>查看已安装证书信息</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">acme.sh --info -d example.com</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">会输出如下内容：</span></span><br><span class="line">DOMAIN_CONF=/root/.acme.sh/example.com/example.com.conf</span><br><span class="line">Le_Domain=example.com</span><br><span class="line">Le_Alt=no</span><br><span class="line">Le_Webroot=dns_ali</span><br><span class="line">Le_PreHook=</span><br><span class="line">Le_PostHook=</span><br><span class="line">Le_RenewHook=</span><br><span class="line">Le_API=https://acme-v02.api.letsencrypt.org/directory</span><br><span class="line">Le_Keylength=</span><br><span class="line">Le_OrderFinalize=https://acme-v02.api.letsencrypt.org/acme/finalize/23xxxx150/781xxxx4310</span><br><span class="line">Le_LinkOrder=https://acme-v02.api.letsencrypt.org/acme/order/233xxx150/781xxxx4310</span><br><span class="line">Le_LinkCert=https://acme-v02.api.letsencrypt.org/acme/cert/04cbd28xxxxxx349ecaea8d07</span><br><span class="line">Le_CertCreateTime=1649358725</span><br><span class="line">Le_CertCreateTimeStr=Thu Apr  7 19:12:05 UTC 2022</span><br><span class="line">Le_NextRenewTimeStr=Mon Jun  6 19:12:05 UTC 2022</span><br><span class="line">Le_NextRenewTime=1654456325</span><br><span class="line">Le_RealCertPath=</span><br><span class="line">Le_RealCACertPath=</span><br><span class="line">Le_RealKeyPath=/etc/acme/example.com/privkey.pem</span><br><span class="line">Le_ReloadCmd=service nginx force-reload</span><br><span class="line">Le_RealFullChainPath=/etc/acme/example.com/chain.pem</span><br></pre></td></tr></table></figure><h4 id="更新证书"><a href="#更新证书" class="headerlink" title="更新证书"></a>更新证书</h4><p>目前证书在 60 天以后会自动更新，你无需任何操作。 今后有可能会缩短这个时间， 不过都是自动的， 你不用关心.请确保 cronjob 正确安装，看起来是类似这样的:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab  -l</span><br><span class="line">56 * * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null</span><br></pre></td></tr></table></figure><h3 id="关于修改ReloadCmd"><a href="#关于修改ReloadCmd" class="headerlink" title="关于修改ReloadCmd"></a>关于修改ReloadCmd</h3><p>目前修改<code>ReloadCmd</code>没有专门的命令，可以通过重新安装证书来实现修改<code>reloadCmd</code>的目的。 此外，安装证书后，相关信息是保存在<code>~/.acme.sh/example.com/example.conf</code>文件下的，内容就是<code>acme.sh --info -d example.com</code>输出的信息，不过<code>ReloadCmd</code>在文件中使用了Base64编码。理论上可以通过直接修改该文件来修改<code>ReloadCmd</code>，且修改时，无需Base64编码，直接写命令原文<code>acme.sh</code>也可以识别。 不过，<code>example.conf</code>文件的位置和内容格式以后可能会改变！<code>example.conf</code>一直都是内部使用, 后面有可能会改为用 sqlite 或者mysql 格式存储. 所以一般不建议自己修改。</p><h3 id="更新-acme-sh"><a href="#更新-acme-sh" class="headerlink" title="更新 acme.sh"></a>更新 acme.sh</h3><p>目前由于 acme 协议和 letsencrypt CA 都在频繁的更新，因此 acme.sh 也经常更新以保持同步。升级 acme.sh 到最新版 :</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">acme.sh --upgrade</span><br></pre></td></tr></table></figure><p>如果你不想手动升级， 可以开启自动升级:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">acme.sh --upgrade --auto-upgrade</span><br></pre></td></tr></table></figure><p>之后，acme.sh 就会自动保持更新了。</p><p>你也可以随时关闭自动更新:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">acme.sh --upgrade --auto-upgrade  0</span><br></pre></td></tr></table></figure><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>如果服务http服务设置了<code>return 301 https://$host$request_uri;</code>来跳转到https服务下，且https服务又是代理其他服务，如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  example.com;</span><br><span class="line">    ssl_certificate      conf.d/cert.pem;</span><br><span class="line">    ssl_certificate_key  conf.d/key.key;</span><br><span class="line">    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line">    add_header X-Frame-Options &quot;SAMEORIGIN&quot;;</span><br><span class="line">    add_header X-XSS-Protection &quot;1; mode=block&quot;;</span><br><span class="line">    add_header X-Content-Type-Options &quot;nosniff&quot;;</span><br><span class="line"></span><br><span class="line">    # 这里要加上以下设置，防止nginx找不到文件</span><br><span class="line">    location ^~ /.well-known/acme-challenge/ &#123;</span><br><span class="line">        root /home/wwwroot/mydomain.com;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    location ^~/ &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:10080;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>有时候自动更新证书没有成功，用以下命令可手动更新：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新所有</span></span><br><span class="line">acme.sh --renew-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新指定的 exam.com 域名</span></span><br><span class="line">acme.sh --renew -d exam.com</span><br></pre></td></tr></table></figure><p>但有时候证书已更新，但未能同步到服务器中，可以在以上命令行最后加上 <code>--force</code>。</p><hr><p>官网地址：<a href="https://github.com/acmesh-official/acme.sh">https://github.com/acmesh-official/acme.sh</a></p><p>官方文档：<a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E">https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E</a></p>]]></content>
      
      
      <categories>
          
          <category> 网络 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>使用hexo和git实现多地更新和配置博客源文件</title>
      <link href="//hexo/hexo-git.html"/>
      <url>//hexo/hexo-git.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>使用<a href="https://hexo.io/zh-cn/">hexo</a>写博客的一个问题就是源文件都是在本地的，如果换了电脑需要更新博客时就会比较麻烦。目前，觉得比较靠谱的办法就是用github来管理了。</p><ul><li>利用git分支实现</li><li>hexo生成的静态博客文件默认放在master分支上。</li><li>hexo的源文件（部署环境文件）可以都放在hexo分支上（可以新创建一个hexo分支），换新电脑时，直接git clone hexo分支</li></ul><h3 id="hexo搭建博客原理"><a href="#hexo搭建博客原理" class="headerlink" title="hexo搭建博客原理"></a>hexo搭建博客原理</h3><ul><li>hexo帮助把博客发送到github，同时把md文件转换成网页文件。</li><li>hexo目录下的文件和github上的文件是不同的，public文件夹的文件通过hexo d 上传到github去了，其他的文件则留在本地目录下。</li></ul><h3 id="搭建hexo服务器端电脑设置"><a href="#搭建hexo服务器端电脑设置" class="headerlink" title="搭建hexo服务器端电脑设置"></a>搭建hexo服务器端电脑设置</h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ul><li>首先确保自己已经使用hexo在<a href="https://so.csdn.net/so/search?q=github&amp;spm=1001.2101.3001.7020">github</a>搭建好了自己的个人博客。</li></ul><h4 id="对username-github-io仓库新建hexo分支，并克隆"><a href="#对username-github-io仓库新建hexo分支，并克隆" class="headerlink" title="对username.github.io仓库新建hexo分支，并克隆"></a>对username.github.io仓库新建hexo分支，并克隆</h4><ul><li>在Github的username.github.io仓库上新建一个xxx分支，并切换到该分支，并在该仓库-&gt;Settings-&gt;Branches-&gt;Default branch中将默认分支设为xxx，save保存；然后将该仓库克隆到本地，进入该username.github.io文件目录</li><li>完成上面步骤后，在当前目录使用Git Bash执行git branch命令查看当前所在分支，应为新建的分支xxx</li></ul><h4 id="将本地博客的部署文件拷贝进username-github-io文件目录"><a href="#将本地博客的部署文件拷贝进username-github-io文件目录" class="headerlink" title="将本地博客的部署文件拷贝进username.github.io文件目录"></a>将本地博客的部署文件拷贝进username.github.io文件目录</h4><ul><li>如题，先将本地博客的部署文件（Hexo目录下的全部文件）全部拷贝进username.github.io文件目录中去。</li><li>接下来，进入username.github.io文件目录下，将该目录下的全部文件提交到xxx分支，提交之前需注意：<ul><li>将themes目录以内中的主题的.git目录删除（如果有），因为一个git仓库中不能包含另一个git仓库，提交主题文件夹会失败。</li><li>可能有人会问，删除了themes目录中的.git不就不能git pull更新主题了吗，很简单，需要更新主题时在另一个地方git clone下来该主题的最新版本，然后将内容拷到当前主题目</li></ul></li></ul><h4 id="提交hexo分支"><a href="#提交hexo分支" class="headerlink" title="提交hexo分支"></a>提交hexo分支</h4><ul><li><p>执行git add .、git commit -m ‘back up hexo files’（引号内容可改）、git push即可将博客的hexo部署环境提交到GitHub个人仓库的xxx分支：</p><p>现在可以在GitHub上的username.github.io仓库看到两个分支的差异了。<br>master分支和xxx分支各自保存着一个版本，master分支用于保存博客静态资源，提供博客页面供人访问；xxx分支用于备份博客部署文件，供自己维护更新，两者在一个GitHub仓库内互不冲突。</p></li></ul><h3 id="其他任何一台电脑"><a href="#其他任何一台电脑" class="headerlink" title="其他任何一台电脑"></a>其他任何一台电脑</h3><p>至此，你的博客已经可以在其他电脑上进行同步的维护和更新了，方法很简单：</p><ul><li>将新电脑的生成的ssh key添加到GitHub账户上</li><li>在新电脑上克隆username.github.io仓库的xxx分支到本地，此时本地git仓库处于xxx分支</li><li>切换到username.github.io目录，执行npm install(由于仓库有一个.gitignore文件，里面默认是忽略掉 node_modules文件夹的，也就是说仓库的hexo分支并没有存储该目录[也不需要]，所以需要install下)</li><li>到这里了就可以开始在自己的电脑上写博客了！</li></ul><p>编辑、撰写文章或其他博客更新改动：</p><ul><li>依次执行git add .、git commit -m ‘back up hexo files’（引号内容可改）、git push指令，保证xxx分支版本最新</li><li>执行hexo d -g指令（在此之前，有时可能需要执行hexo clean），完成后就会发现，最新改动已经更新到master分支了，两个分支互不干扰！</li></ul><h3 id="回到hexo服务器端电脑更新并提交博客"><a href="#回到hexo服务器端电脑更新并提交博客" class="headerlink" title="回到hexo服务器端电脑更新并提交博客"></a>回到hexo服务器端电脑更新并提交博客</h3><p>注：<a href="https://blog.csdn.net/qq_41684957/article/details/90680765">原地址</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo命令</title>
      <link href="//hello-word.html"/>
      <url>//hello-word.html</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>第一次用hexo写博客，之前有自己用自己的服务器写过博客，但后来服务器出问题，不堪回首，现在要用这个来重写博客了！！！</p><hr><h3 id="总要记录一点什么吧"><a href="#总要记录一点什么吧" class="headerlink" title="总要记录一点什么吧"></a>总要记录一点什么吧</h3><p>hexo的一些常用命令模版</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo s # 启动服务</span><br><span class="line">hexo d -g # 编译项目并推送到github下mater分支</span><br><span class="line">hexo new post 测试 --path hexo/test # 创建title为测试文件名为test.md位置在hexo文件夹下的文章</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
